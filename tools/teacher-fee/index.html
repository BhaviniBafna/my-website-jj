<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Teacher Fee Statement</title>

<!-- jsPDF -->
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

<style>
body{font-family:Arial,Helvetica,sans-serif;background:#f9fafb;margin:0}
.wrap{max-width:1200px;margin:24px auto;padding:0 16px}
.card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px}
h1,h2{margin:12px 0}
label{font-size:12px;color:#555}
input,select,textarea,button{width:100%;padding:8px;border:1px solid #ccc;border-radius:8px}
button{cursor:pointer;font-weight:600}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
.col-4{grid-column:span 4}.col-3{grid-column:span 3}.col-6{grid-column:span 6}.col-12{grid-column:span 12}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.day{border:1px solid #ddd;border-radius:10px;padding:6px;text-align:center;cursor:pointer}
.day.selected{outline:2px solid #000}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #ddd;padding:6px;font-size:13px}
.right{text-align:right}
.footer{font-size:12px;color:#666;margin-top:10px}
.lock{display:flex;justify-content:center;align-items:center;height:100vh}
.lockbox{background:#fff;border:1px solid #ccc;border-radius:14px;padding:20px;width:320px;text-align:center}
.lockbox img{width:80px;margin-bottom:10px}
</style>
</head>

<body>

<!-- ðŸ”’ LOCK SCREEN -->
<div id="lock" class="lock">
  <div class="lockbox">
    <img src="./JSlogo.png">
    <h2>Teacher Fee Statement</h2>
    <input id="code" type="password" placeholder="Access Code">
    <button onclick="unlock()">Unlock</button>
    <div id="err" style="color:red;display:none">Wrong code</div>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none">
<div class="wrap">
<div class="card">

<h1>Teacher Fee Statement</h1>

<div class="grid">
<div class="col-4">
<label>Teacher</label>
<select id="teacher"></select>
</div>

<div class="col-4">
<label>Student</label>
<input id="student">
</div>

<div class="col-4">
<label>Month</label>
<input id="month" type="month">
</div>

<div class="col-3">
<label>Full Rate (â‚¹)</label>
<input id="fullRate">
</div>

<div class="col-3">
<label>Partial Rate (â‚¹)</label>
<input id="partialRate">
</div>

<div class="col-3">
<label>Payment Mode</label>
<select id="mode">
<option>UPI</option><option>Bank Transfer</option>
</select>
</div>

<div class="col-3">
<label>Issue Date</label>
<input id="issue" type="date">
</div>
</div>

<h2>Select Class Dates</h2>
<div id="calendar" class="calendar"></div>

<h2>Sessions</h2>
<table class="table">
<thead>
<tr><th>Date</th><th>Day</th><th>Status</th><th class="right">â‚¹</th></tr>
</thead>
<tbody id="rows"></tbody>
</table>

<h2>Bonuses</h2>
<table class="table">
<thead><tr><th>Type</th><th>Note</th><th class="right">â‚¹</th></tr></thead>
<tbody id="bonus"></tbody>
</table>
<button onclick="addBonus()">+ Add Bonus</button>

<h2>Total: â‚¹<span id="total">0</span></h2>

<button onclick="save()">Save Statement</button>
<button onclick="pdf()">Generate PDF</button>

<h2>Teacher Monthly Summary</h2>
<select id="sumTeacher"></select>
<input id="sumMonth" type="month">
<button onclick="summary()">Build Summary</button>

<table class="table">
<thead><tr><th>Student</th><th class="right">Classes</th><th class="right">â‚¹</th></tr></thead>
<tbody id="sumRows"></tbody>
</table>

</div>
</div>
</div>

<script>
/* ðŸ” ACCESS */
const ACCESS_CODE="1234";

/* ðŸ‘©â€ðŸ« TEACHERS */
const TEACHERS=[
{name:"Ms. Neha",full:350,partial:100},
{name:"Senior Teacher",full:400,partial:120},
{name:"Junior Teacher",full:250,partial:80}
];

/* ðŸ•’ IST SAFE DATE */
function localDate(iso){
const [y,m,d]=iso.split("-").map(Number);
return new Date(y,m-1,d);
}
const DOW=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];

/* ðŸ”“ */
function unlock(){
if(code.value!==ACCESS_CODE){err.style.display="block";return;}
lock.style.display="none";app.style.display="block";
}

/* INIT */
TEACHERS.forEach(t=>{
teacher.innerHTML+=`<option>${t.name}</option>`;
sumTeacher.innerHTML+=`<option>${t.name}</option>`;
});
teacher.onchange=()=>{
const t=TEACHERS.find(x=>x.name===teacher.value);
fullRate.value=t.full;partialRate.value=t.partial;
};
issue.value=new Date().toISOString().slice(0,10);

/* CALENDAR */
month.onchange=()=>{
calendar.innerHTML="";
rows.innerHTML="";
const [y,m]=month.value.split("-").map(Number);
for(let d=1;d<=31;d++){
const dt=new Date(y,m-1,d);
if(dt.getMonth()!=m-1)break;
const iso=`${y}-${String(m).padStart(2,0)}-${String(d).padStart(2,0)}`;
const div=document.createElement("div");
div.className="day";
div.textContent=d;
div.onclick=()=>{
div.classList.toggle("selected");
render();
};
div.dataset.iso=iso;
calendar.appendChild(div);
}
};

/* RENDER */
function render(){
rows.innerHTML="";
let total=0;
document.querySelectorAll(".day.selected").forEach(d=>{
const iso=d.dataset.iso;
const dt=localDate(iso);
const tr=document.createElement("tr");
tr.innerHTML=`<td>${iso}</td><td>${DOW[dt.getDay()]}</td>
<td>
<select onchange="render()">
<option value="${fullRate.value}">Full</option>
<option value="${partialRate.value}">Partial</option>
<option value="0">Cancelled</option>
</select>
</td>
<td class="right">${fullRate.value}</td>`;
rows.appendChild(tr);
total+=Number(fullRate.value);
});
document.querySelectorAll("#bonus input").forEach(b=>total+=Number(b.value||0));
document.getElementById("total").textContent=total;
}

/* BONUS */
function addBonus(){
const tr=document.createElement("tr");
tr.innerHTML=`<td>
<select>
<option>No cancellation</option>
<option>No show</option>
<option>No late joining</option>
<option>Demo conversion</option>
<option>Teacher upgradation</option>
<option>Birthday bonus</option>
<option>Other</option>
</select>
</td><td><input></td><td class="right"><input value="0"></td>`;
bonus.appendChild(tr);
}

/* SAVE */
function save(){
const key=`TFS|${teacher.value}|${student.value}|${month.value}`;
localStorage.setItem(key,JSON.stringify({total:total.textContent}));
alert("Saved");
}

/* SUMMARY */
function summary(){
sumRows.innerHTML="";
let cls=0,amt=0;
Object.keys(localStorage).forEach(k=>{
if(k.startsWith(`TFS|${sumTeacher.value}|`)&&k.endsWith(sumMonth.value)){
const p=JSON.parse(localStorage.getItem(k));
const s=k.split("|")[2];
sumRows.innerHTML+=`<tr><td>${s}</td><td class="right">-</td><td class="right">â‚¹${p.total}</td></tr>`;
amt+=Number(p.total);
}
});
sumRows.innerHTML+=`<tr><td><b>Total</b></td><td></td><td class="right"><b>â‚¹${amt}</b></td></tr>`;
}

/* PDF */
async function pdf(){
const {jsPDF}=window.jspdf;
const doc=new jsPDF();
doc.text("Teacher Fee Statement",20,20);
doc.text(`Teacher: ${teacher.value}`,20,30);
doc.text(`Student: ${student.value}`,20,40);
doc.text(`Total: â‚¹${total.textContent}`,20,50);
doc.save("Teacher_Fee.pdf");
}
</script>
</body>
</html>
